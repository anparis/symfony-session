{% extends 'base.html.twig' %}

{% block title %}Detail de la session{% endblock %}

{% block body %}
<main>
  <p>A partir du {{ session.dateDebut | format_datetime('long', 'none', locale='fr') }}</p>
  <h1>{{session.titre}}</h1>
  {% if session.programmes is not empty %}

    <div class="modules-list">
      {% set categorie = ''%}
        {% for programme in session.programmes | sort((a, b) => a.module.categorie.id <=> b.module.categorie.id) %}
        <article>
        {% if programme.module.categorie.id == categorie%}
        <ul>
          <li>{{ programme.module }} : {{programme.nbJours}} jours</li>
        </ul>
        {% else %}
        <h4>{{programme.module.categorie}}</h4>
        <hr>
            <ul>
              <li>{{ programme.module }} : {{programme.nbJours}} jours</li>
            </ul>
        {% set categorie = programme.module.categorie.id %}
        {% endif %}
        </article>
        {% endfor %}
    </div>
  {% else %}
    <p>La session ne possède pas de modules.</p>
  {% endif %}
  {% if nonProgrammes is not empty %}
  <table class="table-dark table-striped">
    <thead>
        <tr>
            <th>Module</th>
            <th>Durée</th>
            <th>Programmer</th>
        </tr>
    </thead>
    <tbody>
        {% for module in nonProgrammes %}
        <tr>
            <td>{{ module }}</td>
            <form method="POST" action="{{ path('add_session_module', {'idSe': session.id,'idMo': module.id }) }}">
                <td><input type="number" min="1" id="nbJours" name="nbJours" size="2"/>jours</td>
                <td><button type="submit" name="submit" class="add-button">submit</button></td>
            </form>
        </tr>
        {% endfor %}
    </tbody>
</table>
  {% endif %}

  <br>
  <div class="stagiaires-registered">
    <article>
      <h4>Stagiaires inscrits</h4>
      {% for stagiaire in session.stagiaires %}
      <ul>
        <li><a href="{{path('show_stagiaire', {'id': stagiaire.id})}}">{{stagiaire}}</a></li>
        <button class="btn-delete"><a href="{{path('del_session_stagiaire', {'idSe': session.id, 'idSt': stagiaire.id} )}}">supprimer</a></button>
      </ul>
      {% endfor %}
    </article>
  </div>
  <div class="stagiaires-non-registered">
    <article>
      <h4>Stagiaires non inscrits</h4>
      {% for stagiaire in nonRegistered %}
      <ul>
        <li><a href="{{path('show_stagiaire', {'id': stagiaire.id})}}">{{stagiaire}}</a></li>
        <button class="btn-add"><a href="{{path('add_session_stagiaire', {'idSe': session.id, 'idSt': stagiaire.id} )}}">ajouter à la session</a></button>
      </ul>
      {% endfor %}
    </article>
  </div>
</main>
{% endblock %}